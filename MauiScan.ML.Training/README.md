# MauiScan ML è®­ç»ƒç¯å¢ƒ

PPT å››è§’ç‚¹æ£€æµ‹æ¨¡å‹çš„è®­ç»ƒè„šæœ¬å’Œå·¥å…·ã€‚

## ç¯å¢ƒæ­å»º

### 1. å®‰è£… Python ä¾èµ–

```bash
cd MauiScan.ML.Training
pip install -r requirements.txt
```

**æ¨èä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ**ï¼š
```bash
python -m venv venv
venv\Scripts\activate  # Windows
pip install -r requirements.txt
```

### 2. å‡†å¤‡è®­ç»ƒæ•°æ®

å°† AnnotationTool æ ‡æ³¨çš„æ•°æ®æ”¾ç½®åœ¨ `data/` ç›®å½•ï¼š

```
data/
â”œâ”€â”€ ios/
â”‚   â”œâ”€â”€ image001.jpg
â”‚   â”œâ”€â”€ image001.json
â”‚   â”œâ”€â”€ image002.jpg
â”‚   â”œâ”€â”€ image002.json
â”‚   â””â”€â”€ ...
â”œâ”€â”€ android/
â”‚   â””â”€â”€ ...
â””â”€â”€ classroom1/
    â””â”€â”€ ...
```

### 3. éªŒè¯æ•°æ®

```bash
python dataset/prepare_data.py ../data
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
âœ… æˆåŠŸåŠ è½½ 350 ä¸ªæ ·æœ¬
ğŸ“Š æ•°æ®é›†ç»Ÿè®¡:
  - æ€»æ ·æœ¬æ•°: 350
  - å›¾ç‰‡å°ºå¯¸èŒƒå›´: 1920Ã—1080 ~ 4032Ã—3024
  - è¾¹ç•Œå¤–è§’ç‚¹æ¯”ä¾‹: 1.43%
```

## è®­ç»ƒæ¨¡å‹

### å¿«é€Ÿå¼€å§‹

```bash
python train.py --data-root ../data --epochs 50 --batch-size 16
```

### å®Œæ•´å‚æ•°

```bash
python train.py \
    --data-root ../data \
    --epochs 100 \
    --batch-size 16 \
    --learning-rate 0.001 \
    --val-ratio 0.15 \
    --checkpoint-dir ./checkpoints \
    --log-dir ./logs
```

### å‚æ•°è¯´æ˜

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `--data-root` | `../data` | æ•°æ®æ ¹ç›®å½• |
| `--epochs` | `50` | è®­ç»ƒè½®æ•° |
| `--batch-size` | `16` | æ‰¹æ¬¡å¤§å° |
| `--learning-rate` | `0.001` | å­¦ä¹ ç‡ |
| `--val-ratio` | `0.15` | éªŒè¯é›†æ¯”ä¾‹ |
| `--input-size` | `512` | è¾“å…¥å›¾ç‰‡å°ºå¯¸ |
| `--pretrained` | `True` | ä½¿ç”¨ ImageNet é¢„è®­ç»ƒæƒé‡ |

## å¯¼å‡º ONNX æ¨¡å‹

è®­ç»ƒå®Œæˆåï¼Œå¯¼å‡ºä¸º ONNX æ ¼å¼ä¾› C# ä½¿ç”¨ï¼š

```bash
python models/export_onnx.py \
    checkpoints/best_model.pth \
    --output ppt_corner_detector.onnx \
    --input-size 512
```

å¯¼å‡ºæˆåŠŸåï¼Œå°† `ppt_corner_detector.onnx` å¤åˆ¶åˆ°ï¼š
```
MauiScan/MauiScan/Resources/Raw/ppt_corner_detector.onnx
```

## è¯„ä¼°æ¨¡å‹

```bash
python evaluate.py \
    --model checkpoints/best_model.pth \
    --data-root ../data
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
ğŸ“Š è¯„ä¼°ç»“æœ:
  - å¹³å‡åƒç´ è¯¯å·®: 12.3 px
  - æˆåŠŸç‡ (< 50px): 96.8%
  - å¹³å‡ç½®ä¿¡åº¦: 0.87
```

## è®­ç»ƒç›‘æ§

ä½¿ç”¨ TensorBoard æŸ¥çœ‹è®­ç»ƒè¿›åº¦ï¼š

```bash
tensorboard --logdir logs
```

æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:6006`

## é¡¹ç›®ç»“æ„

```
MauiScan.ML.Training/
â”œâ”€â”€ dataset/
â”‚   â”œâ”€â”€ prepare_data.py        # æ•°æ®åŠ è½½å’Œé¢„å¤„ç†
â”‚   â””â”€â”€ augmentation.py        # æ•°æ®å¢å¼ºï¼ˆTODOï¼‰
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ corner_detector.py     # æ¨¡å‹å®šä¹‰
â”‚   â””â”€â”€ export_onnx.py         # ONNX å¯¼å‡º
â”œâ”€â”€ train.py                   # è®­ç»ƒä¸»è„šæœ¬ï¼ˆTODOï¼‰
â”œâ”€â”€ evaluate.py                # è¯„ä¼°è„šæœ¬ï¼ˆTODOï¼‰
â”œâ”€â”€ requirements.txt           # Python ä¾èµ–
â””â”€â”€ README.md                  # æœ¬æ–‡æ¡£
```

## æ¨¡å‹æ¶æ„

- **éª¨å¹²ç½‘ç»œ**: MobileNetV3-Small (é¢„è®­ç»ƒåœ¨ ImageNet)
- **è¾“å…¥**: RGB å›¾ç‰‡ 512Ã—512
- **è¾“å‡º**:
  - `coordinates`: [8] å››ä¸ªè§’ç‚¹åæ ‡ï¼ˆå½’ä¸€åŒ–ï¼‰
  - `confidence`: [1] æ•´ä½“ç½®ä¿¡åº¦
- **å‚æ•°é‡**: ~1.5M
- **æ¨¡å‹å¤§å°**: ~6 MB (FP32)

## è®­ç»ƒæŠ€å·§

### 1. æ•°æ®å¢å¼º

- äº®åº¦/å¯¹æ¯”åº¦è°ƒæ•´ï¼ˆÂ±30%ï¼‰
- éšæœºæ—‹è½¬ï¼ˆÂ±15Â°ï¼‰
- éšæœºè£å‰ªï¼ˆ90-110%ï¼‰
- æ¨¡æ‹Ÿé«˜å…‰/é˜´å½±

### 2. æŸå¤±å‡½æ•°

```python
Total Loss = 1.0 Ã— Coord_Loss + 0.5 Ã— Order_Loss

- Coord_Loss: Smooth L1 åæ ‡å›å½’æŸå¤±
- Order_Loss: è§’ç‚¹é¡ºåºçº¦æŸæŸå¤±
```

### 3. å­¦ä¹ ç‡ç­–ç•¥

- åˆå§‹å­¦ä¹ ç‡: 0.001
- ä¼˜åŒ–å™¨: Adam
- å­¦ä¹ ç‡è°ƒåº¦: ReduceLROnPlateauï¼ˆéªŒè¯é›†æŸå¤±åœæ»æ—¶é™ä½å­¦ä¹ ç‡ï¼‰

### 4. æ—©åœç­–ç•¥

å¦‚æœéªŒè¯é›†æŸå¤±è¿ç»­ 10 ä¸ª epoch æ²¡æœ‰æ”¹å–„ï¼Œæå‰ç»“æŸè®­ç»ƒã€‚

## å¸¸è§é—®é¢˜

### Q: æ•°æ®é‡ä¸è¶³æ€ä¹ˆåŠï¼Ÿ

**A**: ä½¿ç”¨æ•°æ®å¢å¼ºæ‰©å……æ•°æ®é›†ï¼Œæˆ–ä½¿ç”¨åˆæˆæ•°æ®é¢„è®­ç»ƒã€‚

### Q: è®­ç»ƒå¾ˆæ…¢æ€ä¹ˆåŠï¼Ÿ

**A**:
1. å‡å° `--batch-size`ï¼ˆå¦‚æœ GPU å†…å­˜ä¸è¶³ï¼‰
2. å‡å° `--input-size` åˆ° 416 æˆ– 384
3. ä½¿ç”¨ GPU åŠ é€Ÿï¼ˆCUDAï¼‰

### Q: æ¨¡å‹ç²¾åº¦ä¸å¤Ÿæ€ä¹ˆåŠï¼Ÿ

**A**:
1. å¢åŠ è®­ç»ƒæ•°æ®é‡ï¼ˆç›®æ ‡ 500+ å¼ ï¼‰
2. è°ƒæ•´æŸå¤±å‡½æ•°æƒé‡
3. å¢åŠ è®­ç»ƒè½®æ•°
4. æ”¶é›†å›°éš¾æ ·æœ¬ï¼ˆé«˜å…‰ã€ä½å…‰ã€è¾¹ç•Œå¤–è§’ç‚¹ï¼‰

### Q: å¯¼å‡ºçš„ ONNX æ¨¡å‹å¤ªå¤§æ€ä¹ˆåŠï¼Ÿ

**A**: ä½¿ç”¨é‡åŒ–å‡å°æ¨¡å‹å¤§å°ï¼š
```bash
# INT8 é‡åŒ–ï¼ˆTODO: å¾…å®ç°ï¼‰
python models/quantize_onnx.py ppt_corner_detector.onnx
```

## ä¸‹ä¸€æ­¥

1. âœ… æ•°æ®å‡†å¤‡å®Œæˆ
2. âœ… æ¨¡å‹æ¶æ„è®¾è®¡å®Œæˆ
3. â³ å®ç°è®­ç»ƒä¸»è„šæœ¬ (`train.py`)
4. â³ å®ç°è¯„ä¼°è„šæœ¬ (`evaluate.py`)
5. â³ å®ç°æ•°æ®å¢å¼º (`dataset/augmentation.py`)
6. â³ æ”¶é›†è®­ç»ƒæ•°æ®ï¼ˆ300-500 å¼ ï¼‰
7. â³ è®­ç»ƒåˆç‰ˆæ¨¡å‹
8. â³ å¯¼å‡º ONNX å¹¶é›†æˆåˆ° C# åº”ç”¨

## è®¸å¯åè®®

æœ¬è®­ç»ƒè„šæœ¬æ˜¯ MauiScan é¡¹ç›®çš„ä¸€éƒ¨åˆ†ã€‚
